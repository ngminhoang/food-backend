<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Manage Ingredients</title>
    <nav class="navbar">
        <button class="nav-button" onclick="location.href='/ingredient-management'">Ingredient</button>
        <button class="nav-button" onclick="location.href='/category-management'">Category</button>
        <button class="nav-button" onclick="location.href='/quick-tools'">Statistic</button>
    </nav>
    <style>

        /*!* Styles for the modal *!*/
        /*.input-modal {*/
        /*    display: none; !* Initially hidden *!*/
        /*    position: fixed;*/
        /*    z-index: 1000;*/
        /*    left: 0;*/
        /*    top: 0;*/
        /*    width: 100%;*/
        /*    height: 100%;*/
        /*    overflow: auto;*/
        /*    background-color: rgba(0, 0, 0, 0.4); !* Backdrop effect *!*/
        /*}*/

        /*!* Modal content box *!*/
        /*.input-modal-content {*/
        /*    background-color: #fefefe;*/
        /*    margin: 10% auto; !* Center it vertically and horizontally *!*/
        /*    padding: 20px;*/
        /*    border: 1px solid #888;*/
        /*    border-radius: 8px;*/
        /*    width: 40%; !* Adjust the width as needed *!*/
        /*    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);*/
        /*}*/

        /*!* Close button styles *!*/
        /*.input-close {*/
        /*    color: #aaa;*/
        /*    float: right;*/
        /*    font-size: 28px;*/
        /*    font-weight: bold;*/
        /*    cursor: pointer;*/
        /*}*/

        /*.input-close:hover,*/
        /*.input-close:focus {*/
        /*    color: #000;*/
        /*    text-decoration: none;*/
        /*}*/

        .action-button {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .action-button a {
            text-decoration: none;
            color: inherit;
        }

        .delete-button { background-color: #e74c3c; color: white; }
        .delete-button:hover { background-color: #c0392b; }

        .edit-button { background-color: #3498db; color: white; }
        .edit-button:hover { background-color: #2980b9; }

        .verify-button { background-color: #27ae60; color: white; }
        .verify-button:hover { background-color: #1e8449; }

        .navbar {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #dddddd;
            padding: 1vh;
            gap: 15px;  /* Khoảng cách giữa các nút */
        }

        /* Đặt kiểu cho các nút */
        .nav-button {
            background-color: #4CAF50; /* Màu nền của nút */
            color: white; /* Màu chữ */
            border: none;
            padding: 10px 20px; /* Khoảng cách bên trong nút */
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 5px; /* Góc bo tròn */
            cursor: pointer; /* Con trỏ chuột sẽ chuyển thành tay */
            transition: background-color 0.3s, transform 0.2s; /* Hiệu ứng chuyển động */
        }

        /* Hiệu ứng khi hover chuột vào nút */
        .nav-button:hover {
            background-color: #45a049; /* Thay đổi màu nền khi hover */
            transform: scale(1.1); /* Phóng to nút khi hover */
        }

        /* Hiệu ứng khi nút đang được nhấn */
        .nav-button:active {
            transform: scale(0.95); /* Thu nhỏ nút khi nhấn */
        }

        /* Đảm bảo rằng thanh điều hướng và các nút sẽ căn giữa trên màn hình nhỏ */
        @media screen and (max-width: 600px) {
            .navbar {
                flex-direction: column; /* Xếp các nút theo chiều dọc trên màn hình nhỏ */
            }
        }
        /* Table Styling */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        table th {
            background-color: #f4f4f4;
            font-weight: bold;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            font-family: Arial, sans-serif;
            gap: 5px;
        }

        .pagination a {
            text-decoration: none;
            padding: 8px 12px;
            border: 1px solid #ddd;
            color: #007bff;
            border-radius: 5px;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        .pagination a:hover {
            background-color: #f4f4f4;
        }

        .pagination a.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
            cursor: default;
        }

        .pagination span {
            padding: 8px 12px;
            color: #888;
            font-size: 14px;
        }

        /* General Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f7f7f7;
            color: #333;
        }

        /* Search Form */
        .search-form {
            display: flex;
            align-items: center;
            justify-content: start;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            padding: 8px 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            flex: 1;
        }

        .search-select {
            padding: 8px 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
        }

        .search-button {
            padding: 8px 15px;
            font-size: 14px;
            background-color: #007BFF;
            border: none;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-button:hover {
            background-color: #0056b3;
        }

        /* Create Button */
        .create-button {
            margin-top: 10px;
            display: inline-block;
        }

        .create-link {
            display: block;
            padding: 8px 15px;
            font-size: 14px;
            text-decoration: none;
            background-color: #28a745;
            color: #fff;
            border-radius: 4px;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .create-link:hover {
            background-color: #218838;
        }


    </style>
</head>
<body>


<!--<div id="keyModal" class="input-modal">-->
<!--    <div class="input-modal-content">-->
<!--        <span class="input-close">&times;</span>-->
<!--        <h2>Top </h2>-->
<!--        <form id="createKeyForm">-->
<!--            <label for="keyName">Key Name:</label>-->
<!--            <input type="text" id="keyName" name="keyName" required><br><br>-->

<!--            <label for="accurateType">Accurate Type:</label>-->
<!--            <select id="accurateType" name="accurateType" required>-->
<!--                <option value="0">Partial</option>-->
<!--                <option value="1">Unamious</option>-->
<!--            </select><br><br>-->

<!--            <label for="displayKeys">Display Keywords (comma separated):</label>-->
<!--            <input type="text" id="displayKeys" name="displayKeys" required><br><br>-->

<!--            <button type="submit">Submit</button>-->
<!--        </form>-->
<!--    </div>-->
<!--</div>-->
<!--<button id="openModalBtn">Add New</button>-->

<h1>Ingredient Management</h1>

<!-- Search and Filter -->
<form class="search-form" th:action="@{/ingredient-management}" method="get">
    <div><input class="search-input" type="text" name="search" placeholder="Search by name" th:value="${search}"></div>
    <div>
        <label></label>
        <select class="search-select" name="isVerified">
            <option th:value="null" th:selected="${isVerified == null}">No check verified attribute</option>
            <option th:value="true" th:selected="${isVerified == true}">Verified (worked when no order)</option>
            <option th:value="false" th:selected="${isVerified == false}">Unverified (worked when no order)</option>
        </select>
        <select class="search-select" name="sortOrder">
            <option th:value="null" th:selected="${sortOrder == null}">No Order Viral</option>
            <option th:value="asc" th:selected="${sortOrder == 'asc'}">Ascending Viral</option>
            <option th:value="desc" th:selected="${sortOrder == 'desc'}">Descending Viral</option>
        </select>

        <button class="search-button" type="submit">Search</button>
    </div>

</form>

    <a class="create-link" style="width:10vh" th:href="@{/ingredient-create}">Create New Ingredient</a>


<!-- Create New -->


<div class="pagination">
    <a th:if="${currentPage > 0}" th:href="@{/ingredient-management(page=${currentPage - 1}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}" class="prev">Previous</a>

    <!-- First Page -->
    <a th:if="${currentPage > 5}" th:href="@{/ingredient-management(page=0, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}">1</a>
    <span th:if="${currentPage > 5}">...</span>

    <!-- Page Numbers -->
    <span th:each="pageNum : ${#numbers.sequence((currentPage - 5 > 0 ? currentPage - 5 : 0), (currentPage + 5 < totalPages - 1 ? currentPage + 5 : totalPages - 1))}">
        <a th:href="@{/ingredient-management(page=${pageNum}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}"
           th:text="${pageNum + 1}" th:classappend="${currentPage == pageNum} ? 'active' : ''"></a>
    </span>

    <!-- Last Page -->
    <span th:if="${currentPage < totalPages - 6}">...</span>
    <a th:if="${currentPage < totalPages - 6}" th:href="@{/ingredient-management(page=${totalPages - 1}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}" th:text="${totalPages}"></a>

    <a th:if="${currentPage < totalPages - 1}" th:href="@{/ingredient-management(page=${currentPage + 1}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}" class="next">Next</a>
</div>

<!-- Data Table -->
<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Grams</th>
        <th>Calories</th>
        <th>Proteins</th>
        <th>Carbs</th>
        <th>Fibers</th>
        <th>Fats</th>
        <th>Saturated Fats</th>
        <th>Price</th>
        <th>Category</th>
        <th>Image</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="ingredient : ${ingredients}">
        <td th:text="${ingredient.id}"></td>
        <td th:text="${ingredient.name}"></td>
        <td th:text="${ingredient.nuGrams}"></td>
        <td th:text="${ingredient.nuCalories}"></td>
        <td th:text="${ingredient.nuProteins}"></td>
        <td th:text="${ingredient.nuCarbs}"></td>
        <td th:text="${ingredient.nuFibers}"></td>
        <td th:text="${ingredient.nuFats}"></td>
        <td th:text="${ingredient.nuSatFats}"></td>
        <td th:if="${ingredient.nuPrice != null && ingredient.nuPrice != 0}" th:text="${ingredient.nuPrice}"></td>
        <td th:if="${ingredient.nuPrice == null || ingredient.nuPrice == 0}" th:text="0"  style="color: red"></td>
        <td th:if="${ingredient.category != null}" th:text="${ingredient.category.name}"></td>
        <td th:if="${ingredient.category == null}" style="color: red" >NO CATEGORY</td>
        <td th:if="${ingredient.getImgPaths()!=null && !ingredient.getImgPaths().isEmpty()}" class="image-cell">
            <div style="display: flex">
                <div th:each="imgPath : ${ingredient.getImgPaths()}" style="margin-right:10px ">
                        <img th:src="'http://localhost:8080'+${imgPath}" width="180px" height="180px" alt="">
                </div>
            </div>
        </td>
        <td th:if="${ingredient.getImgPaths()==null || ingredient.getImgPaths().isEmpty()}" class="image-cell" style="color: red">NO IMAGE</td>
        <td>
             <button class="edit-button" th:onclick=""><a th:href="@{/ingredient-form(id=${ingredient.id})}">Edit</a></button>

            <form th:action="@{/delete/{id}(id=${ingredient.id})}" method="post" style="display:inline;">
                <input type="hidden" name="_method" value="DELETE">
                <button class="delete-button" type="submit" onclick="return confirm('Are you sure you want to delete this ingredient?')">Delete</button>
            </form>

            <form  th:action="@{/verify/{id}(id=${ingredient.id})}" method="post" style="display:inline;">
                <input type="hidden" name="_method" value="VERIFY">
                <button th:if="${!ingredient.isVerified}" type="submit" style="background-color:#a4f8c9;">Verify</button>
                <button th:if="${ingredient.isVerified}" type="submit"  style="background-color:#e8b9b9">Clear verify</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<!-- Pagination -->
<div class="pagination">
    <a th:if="${currentPage > 0}" th:href="@{/ingredient-management(page=${currentPage - 1}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}" class="prev">Previous</a>

    <!-- First Page -->
    <a th:if="${currentPage > 5}" th:href="@{/ingredient-management(page=0, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}">1</a>
    <span th:if="${currentPage > 5}">...</span>

    <!-- Page Numbers -->
    <span th:each="pageNum : ${#numbers.sequence((currentPage - 5 > 0 ? currentPage - 5 : 0), (currentPage + 5 < totalPages - 1 ? currentPage + 5 : totalPages - 1))}">
        <a th:href="@{/ingredient-management(page=${pageNum}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}"
           th:text="${pageNum + 1}" th:classappend="${currentPage == pageNum} ? 'active' : ''"></a>
    </span>

    <!-- Last Page -->
    <span th:if="${currentPage < totalPages - 6}">...</span>
    <a th:if="${currentPage < totalPages - 6}" th:href="@{/ingredient-management(page=${totalPages - 1}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}" th:text="${totalPages}"></a>

    <a th:if="${currentPage < totalPages - 1}" th:href="@{/ingredient-management(page=${currentPage + 1}, search=${search}, isVerified=${isVerified}, sortOrder=${sortOrder})}" class="next">Next</a>
</div>


<!--<script>-->
<!--    // Get modal elements-->
<!--    const modal = document.getElementById("keyModal");-->
<!--    const openModalBtn = document.getElementById("openModalBtn");-->
<!--    const closeModalBtn = document.querySelector(".input-close");-->

<!--    // Function to open the modal-->
<!--    openModalBtn.addEventListener("click", () => {-->
<!--        modal.style.display = "block";-->
<!--    });-->

<!--    // Function to close the modal when the close button is clicked-->
<!--    closeModalBtn.addEventListener("click", () => {-->
<!--        modal.style.display = "none";-->
<!--    });-->

<!--    // Function to close the modal when clicking outside the modal content-->
<!--    window.addEventListener("click", (event) => {-->
<!--        if (event.target === modal) {-->
<!--            modal.style.display = "none";-->
<!--        }-->
<!--    });-->

<!--</script>-->
</body>
</html>
